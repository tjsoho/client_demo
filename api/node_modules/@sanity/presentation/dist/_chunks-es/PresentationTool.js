import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{studioPath as r}from"@sanity/client/csm";import{Button as i,Card as o,Flex as a,Container as s,Stack as c,Text as d,Inline as l,Box as u,Code as p,Label as m,ErrorBoundary as h,TextInput as f,MenuItem as v,useToast as g,usePrefersReducedMotion as y,TooltipDelayGroupProvider as w,Tooltip as b,Switch as x,MenuButton as P,Menu as k,Spinner as E,BoundaryElementProvider as S}from"@sanity/ui";import{createContext as I,useContext as _,useLayoutEffect as z,useMemo as D,useRef as C,useState as $,useCallback as O,useEffect as R,forwardRef as j,memo as L,createElement as T,startTransition as U,useReducer as A,Suspense as W,lazy as M}from"react";import{useTranslation as N,useUnique as F,getPublishedId as K,useDocumentPreviewStore as V,getPreviewStateObservable as B,useSchema as q,SanityDefaultPreview as G,getPreviewValueWithFallback as H,PreviewCard as J,Translate as X,CommentsIntentProvider as Z,useActiveWorkspace as Q,useClient as Y,useCurrentUser as ee,Hotkeys as te,useEditState as ne,useProjectId as re,useDataset as ie,useWorkspace as oe}from"sanity";import{StateLink as ae,useRouter as se,decodeJsonParams as ce}from"sanity/router";import{styled as de}from"styled-components";import{p as le,u as ue,P as pe,a as me,b as he,A as fe,M as ve,c as ge,C as ye,E as we,D as be}from"./index.js";import{WarningOutlineIcon as xe,ResetIcon as Pe,LaunchIcon as ke,CopyIcon as Ee,PanelLeftIcon as Se,RefreshIcon as Ie,ShareIcon as _e,ChevronDownIcon as ze,CheckmarkIcon as De,MobileDeviceIcon as Ce,DesktopIcon as $e,EditIcon as Oe,PublishIcon as Re}from"@sanity/icons";import{PaneRouterContext as je,PaneLayout as Le,StructureToolProvider as Te,DocumentListPane as Ue,DocumentPane as Ae}from"sanity/structure";import{D as We}from"./DisplayedDocumentBroadcaster.js";import{hasSecretSearchParams as Me,setSecretSearchParams as Ne,withoutSecretSearchParams as Fe}from"@sanity/preview-url-secret/without-secret-search-params";import{motion as Ke,MotionConfig as Ve,AnimatePresence as Be}from"framer-motion";import{createPreviewSecret as qe}from"@sanity/preview-url-secret/create-secret";import Ge from"fast-deep-equal";import{match as He}from"path-to-regexp";import{definePreviewUrl as Je}from"@sanity/preview-url-secret/define-preview-url";import{suspend as Xe}from"suspend-react";for(var Ze=[],Qe=0;Qe<256;++Qe)Ze.push((Qe+256).toString(16).slice(1));var Ye,et=new Uint8Array(16);function tt(){if(!Ye&&!(Ye=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ye(et)}var nt={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function rt(e,t,n){if(nt.randomUUID&&!t&&!e)return nt.randomUUID();var r=(e=e||{}).random||(e.rng||tt)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,function(e,t=0){return(Ze[e[t+0]]+Ze[e[t+1]]+Ze[e[t+2]]+Ze[e[t+3]]+"-"+Ze[e[t+4]]+Ze[e[t+5]]+"-"+Ze[e[t+6]]+Ze[e[t+7]]+"-"+Ze[e[t+8]]+Ze[e[t+9]]+"-"+Ze[e[t+10]]+Ze[e[t+11]]+Ze[e[t+12]]+Ze[e[t+13]]+Ze[e[t+14]]+Ze[e[t+15]]).toLowerCase()}(r)}const it=1e3,ot=1e3,at=500,st=["handshake/syn","handshake/syn-ack","handshake/ack"],ct=e=>st.some((t=>t===e)),dt=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function lt(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(ct(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),d(e,"handshake/ack",{id:e.id}))}}const o=t=>{const r=t.data;if(!ct(r.type)&&n.find((e=>e.id===r.connectionId))){const t=n.find((e=>e.config.id===r.from));if(t){const n=[r.type,r.data];t.config.onEvent?.(...n),e.onEvent?.(...n),l(t,"channel/response",{responseTo:r.id},!1)}}};function a(t){if(dt(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;n.find((t=>t.config.id===e.from))?.handler(t)}}function s(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){t.status=n,t.config.onStatusUpdate?.(n,t.config.id),e.onStatusUpdate?.(n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,s(t),function(e){e.id=rt(),e.interval=window.setInterval((()=>{d(e,"handshake/syn",{id:e.id})}),at)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(s(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:ot;e.heartbeat=window.setInterval((()=>{l(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{l(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),s(t))}function d(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:rt(),to:n.config.id,type:r};try{t?.postMessage(o,{targetOrigin:"*"})}catch{throw new Error(`Failed to postMessage '${o.id}' on '${e.id}'`)}}function l(n,r,i,o=!0){const a=rt();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{s.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn(`Received no response to message '${s.type}' on client '${e.id}' (ID: '${s.id}').`))}),it),o=e=>{const{data:n}=e;"channel/response"===n.type&&n.data?.responseTo&&n.data.responseTo===s.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{t?.postMessage(s,{targetOrigin:e.targetOrigin})}catch{throw new Error(`Failed to postMessage '${s.id}' on client '${e.id}'`)}}return window.addEventListener("message",a,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(l(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",a,!1),n.forEach((e=>{s(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");l(i,t,r)}))}}}var ut,pt,mt,ht;function ft(e){let t=typeof e;return"object"===t&&(t=(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null"),"string"===t?`"${e}"`:"number"===t||"bigint"===t||"boolean"===t?`${e}`:t}function vt(e,t,n,r,i){const o=i&&"input"in i?i.input:n.value,a=i?.expected??e.expects,s=i?.received??ft(o),c={kind:e.kind,type:e.type,input:o,expected:a,received:s,message:`Invalid ${t}: ${a?`Expected ${a} but r`:"R"}eceived ${s}`,requirement:e.requirement,path:i?.path,issues:i?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly,skipPipe:r.skipPipe},d="schema"===e.kind,l=e.message??(u=e.reference,p=c.lang,ht?.get(u)?.get(p))??(d?function(e){return mt?.get(e)}(c.lang):null)??r.message??function(e){return pt?.get(e)}(c.lang);var u,p;l&&(c.message="function"==typeof l?l(c):l),d&&(n.typed=!1),n.issues?n.issues.push(c):n.issues=[c]}function gt(e){return"__proto__"!==e&&"prototype"!==e&&"constructor"!==e}var yt=class extends Error{issues;constructor(e){super(e[0].message),this.name="ValiError",this.issues=e}};function wt(e,t,n){return"function"==typeof e.fallback?e.fallback(t,n):e.fallback}function bt(e){return{kind:"schema",type:"boolean",reference:bt,expects:"boolean",async:!1,message:e,_run(e,t){return"boolean"==typeof e.value?e.typed=!0:vt(this,"type",e,t),e}}}function xt(e,t){return{kind:"schema",type:"object",reference:xt,expects:"Object",async:!1,entries:e,message:t,_run(e,t){const n=e.value;if(n&&"object"==typeof n){e.typed=!0,e.value={};for(const r in this.entries){const i=n[r],o=this.entries[r]._run({typed:!1,value:i},t);if(o.issues){const a={type:"object",origin:"value",input:n,key:r,value:i};for(const t of o.issues)t.path?t.path.unshift(a):t.path=[a],e.issues?.push(t);if(e.issues||(e.issues=o.issues),t.abortEarly){e.typed=!1;break}}o.typed||(e.typed=!1),(void 0!==o.value||r in n)&&(e.value[r]=o.value)}}else vt(this,"type",e,t);return e}}}function Pt(e,...t){const n={kind:"schema",type:"optional",reference:Pt,expects:`${e.expects} | undefined`,async:!1,wrapped:e,_run(e,t){return void 0===e.value&&("default"in this&&(e.value=function(e,t,n){return"function"==typeof e.default?e.default(t,n):e.default}(this,e,t)),void 0===e.value)?(e.typed=!0,e):this.wrapped._run(e,t)}};return 0 in t&&(n.default=t[0]),n}function kt(e){return{kind:"schema",type:"string",reference:kt,expects:"string",async:!1,message:e,_run(e,t){return"string"==typeof e.value?e.typed=!0:vt(this,"type",e,t),e}}}function Et(e,t,n){const r=e._run({typed:!1,value:t},function(e){return{lang:e?.lang??ut?.lang,message:e?.message,abortEarly:e?.abortEarly??ut?.abortEarly,abortPipeEarly:e?.abortPipeEarly??ut?.abortPipeEarly,skipPipe:e?.skipPipe}}(n));if(r.issues)throw new yt(r.issues);return r.value}const St=/^([A-Za-z]+):([0-9]+)$/,It=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,_t=/^([A-Za-z]+):([a-z0-9]+)$/;const zt=function(...e){return{...e[0],pipe:e,_run(t,n){for(let r=0;r<e.length;r++){t=e[r]._run(t,n);const i=e[r+1];if(n.skipPipe||t.issues&&(n.abortEarly||n.abortPipeEarly||"schema"===i?.kind||"transformation"===i?.kind)){t.typed=!1;break}}return t}}}(kt(),function e(t,n){return{kind:"validation",type:"min_length",reference:e,async:!1,expects:`>=${t}`,requirement:t,message:n,_run(e,t){return e.typed&&e.value.length<this.requirement&&vt(this,"length",e,t,{received:`${e.value.length}`}),e}}}(1)),Dt=Pt(zt);function Ct(e,t){return`${e}-${"string"==typeof t?t:JSON.stringify(t)}`}xt({baseUrl:zt,dataset:Dt,id:zt,path:zt,projectId:Dt,tool:Dt,type:Dt,workspace:Dt,isDraft:Pt(kt())}),xt({origin:zt,href:zt,data:Pt(function e(t,n,r){return{kind:"schema",type:"record",reference:e,expects:"Object",async:!1,key:t,value:n,message:r,_run(e,t){const n=e.value;if(n&&"object"==typeof n){e.typed=!0,e.value={};for(const r in n)if(gt(r)){const i=n[r],o=this.key._run({typed:!1,value:r},t);if(o.issues){const a={type:"record",origin:"key",input:n,key:r,value:i};for(const t of o.issues)t.path=[a],e.issues?.push(t);if(e.issues||(e.issues=o.issues),t.abortEarly){e.typed=!1;break}}const a=this.value._run({typed:!1,value:i},t);if(a.issues){const o={type:"record",origin:"value",input:n,key:r,value:i};for(const t of a.issues)t.path?t.path.unshift(o):t.path=[o],e.issues?.push(t);if(e.issues||(e.issues=a.issues),t.abortEarly){e.typed=!1;break}}(!o.typed||!a.typed)&&(e.typed=!1),o.typed&&(e.value[o.value]=a.value)}}else vt(this,"type",e,t);return e}}}(kt(),function e(){return{kind:"schema",type:"unknown",reference:e,expects:"unknown",async:!1,_run:e=>(e.typed=!0,e)}}()))});const $t={alt:"altKey",ctrl:"ctrlKey",mod:typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function Ot(e){return"Alt"===e.key}function Rt(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const jt=I(null);jt.displayName="PanelsContext";const Lt=de.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,Tt=function({children:t,defaultSize:n=null,id:r,minWidth:i,maxWidth:o,order:a=0}){const s=_(jt);if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:c,registerElement:d,unregisterElement:l}=s,u=c(r);return z((()=>(d(r,{id:r,type:"panel",defaultSize:n,maxWidth:o??null,minWidth:i??0,order:a}),()=>{l(r)})),[r,n,a,o,i,d,l]),e(Lt,{style:u,children:t})},Ut="presentation/panels",At=()=>JSON.parse(localStorage.getItem(Ut)||"{}"),Wt=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function Mt(){return D((()=>{const e=(e,t)=>{const n=At(),r=Wt(e);(e=>{localStorage.setItem(Ut,JSON.stringify(e))})({...n,[r]:t})};return{get:e=>{const t=At(),n=Wt(e);return Array.isArray(t[n])&&t[n].some((e=>null===e))?void 0:t[n]},set:e,setDebounced:Rt(e,100)}}),[])}function Nt(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,a=i/n*100;return Math.min(o,Math.max(a,t))}function Ft(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Kt(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Vt(e){return"panel"===e.type}function Bt(e){return"resizer"===e.type}function qt(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function Gt(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],s=Nt(r,a,n);a!=s&&(o+=a-s,i[t]=s)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:s}=r;s=s/n*100,null!=a&&(a=a/n*100);const c=Math.min(a??100,Math.max(s,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}const Ht=de.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,Jt=function({children:t}){const n=C(null),[r,i]=$(new Map),o=D((()=>qt(r).filter(Vt)),[r]),[a,s]=$([]),[c,d]=$(null),l=C({elements:r,panels:o,widths:a}),u=O((e=>({flexGrow:Ft(o,e,a),pointerEvents:null===c?void 0:"none"})),[c,o,a]),p=O(((e,t)=>{i((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),m=O((e=>{i((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),h=C({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),f=O(((e,t)=>{const n=qt(r),i=n.findIndex((t=>t.id===e)),o=r.get(e);if(!o||!Bt(o))return;const a=o.el.current;a&&(h.current={resizerIndex:i,panelBefore:n.reduce(((e,t,n)=>Vt(t)&&n<i?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Vt(t)&&n>i?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Kt(t,a),resizerRect:a.getBoundingClientRect(),widths:l.current.widths},d(e))}),[r]),v=O((()=>{d(null)}),[]),g=O(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:i,dragOffset:o,panelBefore:a,panelAfter:c,resizerRect:d}=h.current;if(null==a||null==c)return;const u=r.get(e);if(!u||!Bt(u))return;const p=u.el.current;if(!p)return;const m=Kt(t,p,o,d);if(0===m)return;const{widths:f}=l.current,v=function(e,t,n,r,i,o){const{panels:a,widths:s}=i,{widths:c}=o,d=c||s,l=[...d];{const i=e<0?r:n,o=d[a.findIndex((e=>e.id===i.id))],s=Nt(i,o+Math.abs(e),t);if(o===s)return d;e=e<0?o-s:s-o}let u=0,p=e<0?n:r,m=a.findIndex((e=>e.id===p.id));for(;;){const n=a[m],r=d[m],i=Nt(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,l[m]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--m<0)break}else if(++m>=a.length)break}return 0===u?d:(p=e<0?r:n,m=a.findIndex((e=>e.id===p.id)),l[m]=d[m]+u,l)}(m/n.current.getBoundingClientRect().width*100,i,a,c,l.current,h.current);f.some(((e,t)=>e!==v[t]))&&s(v)}),[r]);z((()=>{l.current.elements=r,l.current.panels=o,l.current.widths=a}),[r,o,a]);const y=Mt();z((()=>{const{widths:e}=l.current;if(e.length===o.length)return;const t=y.get(o);if(t){const e=Gt(o,t,window.innerWidth);return void s(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(o);s(n)}),[y,o]),R((()=>{a.length&&y.setDebounced(o,a)}),[y,o,a]),z((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=l.current,n=Gt(e,t,window.innerWidth);t.some(((e,t)=>e!==n[t]))&&s(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const w=D((()=>({activeResizer:c,drag:g,getPanelStyle:u,registerElement:p,startDragging:f,stopDragging:v,unregisterElement:m})),[c,g,u,p,f,v,m]);return e(jt.Provider,{value:w,children:e(Ht,{ref:n,children:t})})};function Xt(n){const{children:r,message:p,onRetry:m,onContinueAnyway:h,...f}=n,{t:v}=N(le),g=e(i,{fontSize:1,mode:"ghost",onClick:m,text:v("error-card.retry-button.text")}),y=e(i,{fontSize:1,mode:"ghost",tone:"critical",onClick:h,text:v("error-card.continue-button.text")});return e(o,{height:"fill",...f,children:e(a,{align:"center",height:"fill",justify:"center",children:e(s,{padding:4,sizing:"border",width:0,children:t(c,{space:4,children:[t(c,{space:3,children:[e(d,{size:1,weight:"semibold",children:v("error-card.title")}),e(d,{muted:!0,size:1,children:p})]}),r,m&&h?t(l,{space:2,children:[g,y]}):m?e(u,{children:g}):h?e(u,{children:y}):null]})})})})}function Zt(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>`${e}=${t}`)).join("&");return t.length?`?${t}`:""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const Qt=j((function(t,n){const{searchParams:r,...i}=t;return e(ae,{...i,ref:n,state:{type:void 0,_searchParams:Object.entries(r)},title:void 0})})),Yt=j((function(t,n){const{documentId:r,documentType:i,parentRefPath:o,template:a,searchParams:s,...c}=t;return e(ae,{...c,ref:n,state:{id:r,type:i,_searchParams:Object.entries(s)},title:void 0})}));function en(t){const{children:r,onStructureParams:i,structureParams:o,searchParams:a,refs:s}=t,{state:c,resolvePathFromState:d}=se(),l=F(Object.fromEntries(c._searchParams||[])),u=O((e=>`${d(c)}${Zt({...l,...e})}`),[d,l,c]),p=D((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:o,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,i=s?.find((e=>e._id===n||K(e._id)===n));return i?e(ae,{...r,state:{id:n,type:i._type,_searchParams:Object.entries(a)}}):e("div",{...r})},BackLink:t=>e(Qt,{...t,searchParams:a}),ReferenceChildLink:t=>e(Yt,{...t,searchParams:a}),ParameterizedLink:()=>e(n,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{i({...e,inspect:e.inspect??void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:u})),[u,i,s,a,o]);return e(je.Provider,{value:p,children:r})}const tn=de(Le)`
  height: 100%;
`,nn=de(a)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,rn=de(p)`
  white-space: pre-wrap;
`;function on(n){const{mainDocumentState:r,onStructureParams:i,searchParams:a,refs:s}=n,{t:d}=N(le),{devMode:l}=ue(),u=D((()=>s.filter((e=>K(e._id)!==r?.document?._id)).map((e=>e._id))),[r,s]),p=D((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:u}},schemaTypeName:"",title:d("document-list-pane.document-list.title"),type:"documentList"})),[u,d]),[f,v]=$(null),g=O((()=>v(null)),[]),[y]=$((()=>({})));return R((()=>v(null)),[s]),f?e(Xt,{flex:1,message:d("document-list-pane.error.text"),onRetry:g,children:l&&e(o,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(m,{muted:!0,size:0,children:d("presentation-error.label")}),e(rn,{size:1,children:f.error.message})]})})}):e(h,{onCatch:v,children:e(tn,{children:e(Te,{children:e(en,{onStructureParams:i,structureParams:y,searchParams:a,refs:s,children:e(nn,{direction:"column",flex:1,children:e(Ue,{index:0,itemId:"$root",pane:p,paneKey:"$root"})})})})})})}const an=de(p)`
  white-space: pre-wrap;
`;function sn(n){const{documentId:r,documentType:i,onFocusPath:a,onStructureParams:s,searchParams:d,structureParams:l}=n,{template:u,templateParams:p}=l,{t:f}=N(le),{devMode:v}=ue(),g=D((()=>({id:r,options:{id:r,type:i,template:u,templateParameters:ce(p)},title:"",type:"document"})),[r,i,u,p]),[y,w]=$(null),b=O((()=>w(null)),[]);return R((()=>{w(null)}),[r,i,l]),y?e(Xt,{flex:1,message:f("document-pane.error.text"),onRetry:b,children:v&&e(o,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(m,{muted:!0,size:0,children:f("presentation-error.label")}),e(an,{size:1,children:y.error.message})]})})}):e(h,{onCatch:w,children:e(Le,{style:{height:"100%"},children:e(en,{searchParams:d,onStructureParams:s,structureParams:l,children:e(Ae,{paneKey:"document",index:1,itemId:"document",pane:g,onFocusPath:a})})})})}function cn(t){const{documentId:n,documentType:r,onFocusPath:i,onStructureParams:o,searchParams:a,structureParams:s}=t;return e(Te,{children:e(sn,{documentId:n,documentType:r,onFocusPath:i,onStructureParams:o,searchParams:a,structureParams:s})})}function dn(n){const{documentId:r,documentType:i,mainDocumentState:s,onFocusPath:c,onStructureParams:l,refs:p,searchParams:m,structureParams:h}=n,{t:f}=N(le),v=q(),g=O((t=>e(ae,{...t,state:{id:s.document._id,type:s.document._type,_searchParams:Object.entries(m)}})),[s,m]),y=D((()=>v.get(s?.document?._type||"shoe")),[s,v]),w=function(e,t){const n=V(),[r,i]=$({});return R((()=>{if(!t)return;const r=B(n,t,e,"").subscribe((e=>{i(e)}));return()=>{r?.unsubscribe()}}),[n,t,e]),r}(s?.document?._id||"",y),b=D((()=>s?.document?e(G,{...H({value:s.document,published:w.published,draft:w.draft}),schemaType:y,status:e(o,{padding:1,radius:2,shadow:1,children:e(d,{muted:!0,size:0,weight:"medium",children:f("main-document.label")})})}):null),[s,y,f,w]);return r&&i?e(cn,{documentId:r,documentType:i,onFocusPath:c,onStructureParams:l,searchParams:m,structureParams:h}):t(a,{direction:"column",flex:1,height:"fill",children:[s&&e(o,{padding:3,tone:s.document?"inherit":"caution",children:s.document?e(J,{__unstable_focusRing:!0,as:g,"data-as":"a",radius:2,sizing:"border",tone:"inherit",children:b}):e(o,{padding:2,radius:2,tone:"inherit",children:t(a,{gap:3,children:[e(u,{flex:"none",children:e(d,{size:1,children:e(xe,{})})}),e(u,{flex:1,children:e(d,{size:1,children:e(X,{t:f,i18nKey:"main-document.missing.text",components:{Code:"code"},values:{path:s.path}})})})]})})}),e(on,{mainDocumentState:s,onStructureParams:l,searchParams:m,refs:p})]})}const ln=de.div`
  position: relative;
`,un=de.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:e})=>e?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  "}
`,pn=function({id:n,order:r,disabled:i=!1}){const o=C(null),a=_(jt);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const s=function(e){return C(e||rt()).current}(n),{activeResizer:c,drag:d,startDragging:l,stopDragging:u,registerElement:p,unregisterElement:m}=a,h=c===s;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const f=O((e=>{l(s,e.nativeEvent)}),[s,l]),v=O((e=>{d(s,e)}),[s,d]),g=O((()=>{o.current.blur(),u()}),[u]);return R((()=>{if(!h||i)return;const e=function(){const e=document.body.style,t=document.documentElement.style,{cursor:n}=t,{userSelect:r}=e;return t.cursor="ew-resize",e.userSelect="none",()=>{n?t.cursor=n:t.removeProperty("cursor"),r?e.userSelect=r:e.removeProperty("user-select")}}();return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),window.addEventListener("contextmenu",g),()=>{e(),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g),window.removeEventListener("contextmenu",g)}}),[i,h,v,g]),z((()=>(p(s,{id:s,order:r,type:"resizer",el:o}),()=>{m(s)})),[s,r,p,m]),e(ln,{onMouseDown:f,ref:o,children:t(un,{$disabled:i,children:[e("span",{}),e("span",{})]})})},mn=r=>{const{documentId:i,setDisplayedDocument:o,getCommentIntent:a}=r;return t(n,{children:[e(pn,{order:4}),e(Tt,{id:"content",minWidth:325,order:5,children:e(We,{documentId:i,setDisplayedDocument:o,children:e(Z,{getIntent:a,children:r.children})})})]})},hn=t=>{const{documentId:n,documentsOnPage:r,documentType:i,getCommentIntent:o,mainDocumentState:a,onFocusPath:s,onStructureParams:c,searchParams:d,setDisplayedDocument:l,structureParams:u}=t;return e(mn,{documentId:n,getCommentIntent:o,setDisplayedDocument:l,children:e(dn,{documentId:n,documentType:i,mainDocumentState:a,onFocusPath:s,onStructureParams:c,refs:r,searchParams:d,structureParams:u})})},fn=function(t){const{children:n,navigate:r}=t,i=O(((e,t=void 0)=>{r(t||{},e?{preview:e}:{})}),[r]);return e(pe.Provider,{value:i,children:n})};function vn(t){const{unstable_navigator:r}=t,i=!!r?.component,[o,a]=function(e,t){const[n,r]=$((()=>JSON.parse(localStorage.getItem(e)??JSON.stringify(t))));return R((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,r]}("presentation/navigator",i),s=!!i&&o,c=D((()=>{if(i)return()=>a((e=>!e))}),[i,a]),d=O((function(){return e(n,{children:s&&e(gn,{...r})})}),[s,r]);return[{navigatorEnabled:s,toggleNavigator:c},d]}const gn=L((function(r){const{minWidth:i,maxWidth:o,component:a}=r,s=null!=i&&null!=o&&i===o;return t(n,{children:[e(Tt,{id:"navigator",minWidth:i,maxWidth:o,order:1,children:e(a,{})}),e(pn,{order:2,disabled:s})]})})),yn=function(t){const{children:n,params:r}=t,i=D((()=>r),[r]);return e(me.Provider,{value:i,children:n})},wn=function(t){const{children:n,devMode:r,name:i,navigate:o,params:a,searchParams:s,structureParams:c}=t,d=D((()=>({devMode:r,name:i,navigate:o,params:a,searchParams:s,structureParams:c})),[r,i,o,a,s,c]);return e(he.Provider,{value:d,children:n})},bn="ACTION_IFRAME_LOADED",xn="ACTION_IFRAME_REFRESH",Pn="ACTION_IFRAME_RELOAD",kn="ACTION_VISUAL_EDITING_OVERLAYS_TOGGLE",En=(e,t)=>{switch(t.type){case bn:return"loaded"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"loaded"}};case xn:return"refreshing"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"refreshing"}};case Pn:return"reloading"===e.iframe.status?e:{...e,iframe:{...e.iframe,status:"reloading"}};case kn:return Sn(e,t);default:return e}},Sn=(e,t)=>e.visualEditing.overlaysEnabled===t.enabled?e:{...e,visualEditing:{...e.visualEditing,overlaysEnabled:t.enabled}},In=(Cn=bt(),$n=!1,{...Cn,fallback:$n,_run(e,t){return Cn._run(e,t),e.issues?{typed:!0,value:wt(this,e,t)}:e}}),_n=function e(t,n){return{kind:"schema",type:"picklist",reference:e,expects:t.map(ft).join(" | ")||"never",async:!1,options:t,message:n,_run(e,t){return this.options.includes(e.value)?e.typed=!0:vt(this,"type",e,t),e}}}(["loading","loaded","refreshing","reloading"]),zn=xt({mainDocument:In,iframe:xt({status:_n}),visualEditing:xt({overlaysEnabled:bt()})}),Dn={mainDocument:!1,iframe:{status:"loading"},visualEditing:{overlaysEnabled:!1}};var Cn,$n;function On(e){return Et(zn,{...Dn,...e})}const Rn=Ke(de.iframe`
  box-shadow: 0 0 0 1px var(--card-border-color);
  border-top: 1px solid transparent;
  border-bottom: 0;
  border-right: 0;
  border-left: 0;
  max-height: 100%;
  width: 100%;
`),jn=de(u)`
  position: absolute;
  inset: 0;
  background: transparent;
`,Ln=j((function(r,i){const{animate:o,initial:a,onLoad:s,preventClick:c,src:d,variants:l}=r;return t(n,{children:[e(Rn,{animate:o,initial:a,onLoad:s,ref:i,src:d,variants:l}),c&&e(jn,{})]})})),Tn=function(t){const{fontSize:r=1,onChange:i,origin:o,padding:a=3,prefix:s,suffix:c,value:d}=t,{t:l}=N(le),{basePath:u="/"}=Q()?.activeWorkspace||{},p=C(null),[m,h]=$(void 0),[v,g]=$(void 0),y=O((e=>{h(e.currentTarget.value)}),[]),w=O((e=>{if("Enter"===e.key){if(void 0===m)return;const e=m.startsWith("/")||""===m?`${o}${m}`:m;if(!e.startsWith(o+"/")&&e!==o)return void g(l("preview-location-input.error",{origin:o,context:"missing-origin"}));if(!o&&(e.startsWith(`${u}/`)||e===u))return void g(l("preview-location-input.error",{basePath:u,context:"same-base-path"}));const t=e===o?o+"/":e;g(void 0),h(void 0),i(t.slice(o.length)),p.current?.blur()}"Escape"===e.key&&(g(void 0),h(void 0))}),[u,i,o,m,l]),b=O((()=>{g(void 0),h(void 0)}),[]);R((()=>{g(void 0),h(void 0)}),[o,d]);const x=D((()=>({icon:Pe})),[]);return e(n,{children:e(f,{clearButton:v?x:void 0,customValidity:v,fontSize:r,onBlur:b,onClear:()=>{g(void 0),h(o+d)},onChange:y,onKeyDownCapture:w,padding:a,prefix:s,style:{zIndex:1},radius:2,ref:p,space:a,suffix:c,value:void 0===m?`${o}${d}`:m})})};function Un(r){const{initialUrl:i,openPopup:o,previewLocationOrigin:a,previewLocationRoute:s}=r,{t:c}=N(le),d=O((e=>{e.preventDefault(),o(e.currentTarget.href)}),[o]);return t(n,{children:[e(An,{initialUrl:i,previewLocationOrigin:a,previewLocationRoute:s}),e(v,{icon:ke,text:c("share-url.menu-item.open.text"),as:"a",href:`${a}${s}`,onClick:d,rel:"opener",target:"_blank"})]})}function An(t){const{initialUrl:n,previewLocationOrigin:r,previewLocationRoute:i}=t,{t:o}=N(le),{push:a}=g(),s=Y({apiVersion:fe}),c=ee(),[d,l]=$(!1);return e(v,{disabled:d,onClick:()=>{if(!navigator?.clipboard)return a({closable:!0,status:"error",title:o("share-url.clipboard.status",{context:"unsupported"})}),!1;let e;l(!0);const t=`${r}${i}`,d=()=>{a({id:e,closable:!0,status:"success",title:o("share-url.clipboard.status",{context:"success"})}),l(!1)},u=e=>{a({closable:!0,status:"error",title:o("share-url.clipboard.status",{context:"failed"}),description:e.message||e.toString()}),l(!1)};if(Me(n)){const t=async()=>{e=a({closable:!0,title:o("share-url.clipboard.status",{context:"copying"})});const t=await qe(s,"@sanity/presentation",typeof window>"u"?"":location.href,c?.id);return Ne(n,t.secret,i).toString()};if(typeof ClipboardItem<"u"){const e="text/plain",n=new ClipboardItem({[e]:t().then((t=>new Blob([t],{type:e})))});navigator.clipboard.write([n]).then(d).catch(u)}else t().then((e=>navigator.clipboard.writeText(e))).then(d).catch(u)}else navigator.clipboard.writeText(t).then(d).catch(u)},text:o("share-url.menu-item.copy.text"),icon:Ee})}const Wn=Ke(a),Mn={previewDrafts:"preview-frame.perspective.previewDrafts.title",published:"preview-frame.perspective.published.title"},Nn="caution",Fn="positive",Kn={previewDrafts:Oe,published:Re},Vn=j((function(r,s){const{dispatch:l,iframe:h,initialUrl:f,loadersConnection:g,navigatorEnabled:S,onPathChange:I,onRefresh:_,openPopup:z,overlaysConnection:C,perspective:j,previewUrl:L,setPerspective:U,setViewport:A,targetOrigin:W,toggleNavigator:M,toggleOverlay:F,viewport:K,visualEditing:{overlaysEnabled:V}}=r,{t:B}=N(le),{devMode:q}=ue(),G=y(),H=O((()=>A("desktop"===K?"mobile":"desktop")),[A,K]),J="loading"===h.status||"reloading"===h.status,[X,Z]=$(!1),Q="refreshing"===h.status,[Y,ee]=$(!1),ne=J||Q||"connecting"===C,re=D((()=>W===location.origin?"":W),[W]),ie=O((()=>{_((()=>{"function"==typeof s||!s?.current||(l({type:Pn}),s.current.src=`${W}${L||"/"}`)}))}),[l,_,L,W,s]),oe=O((()=>{"function"==typeof s||!s?.current||(s.current.src=f.toString(),l({type:Pn}))}),[l,s,f]),ae=O((()=>{ce(!0)}),[]),[se,ce]=$(!1),[de,pe]=$(!1);R((()=>{if(!(J||Q||"connecting"!==C&&"reconnecting"!==C)){const e=setTimeout((()=>{pe(!0)}),1e3);return()=>clearTimeout(e)}}),[C,J,Q]),R((()=>{if(!J&&!Q&&de){if("connected"===C&&(ee(!1),pe(!1),Z(!1),ce(!1)),"connecting"===C){const e=setTimeout((()=>{Z(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")}),ve);return()=>clearTimeout(e)}if("reconnecting"===C){const e=setTimeout((()=>{Z(!0),ee(!0)}),ve);return()=>clearTimeout(e)}"disconnected"===C&&ee(!0)}}),[J,C,Q,de]);const me=D((()=>{const e=new URL(L||"/",W),{pathname:t,search:n}=Fe(e);return`${t}${n}`}),[L,W]),he=O((()=>{l({type:bn})}),[l]);R((()=>{if("function"==typeof s||!s?.current)return;const e=s.current;function t(){e===document.activeElement&&e.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,cancelable:!0}))}return window.addEventListener("blur",t),()=>{window.removeEventListener("blur",t)}}),[s]);const fe=D((()=>(J||"connecting"===C&&"refreshing"!==h.status)&&!se),[se,h.status,J,C]),ge=D((()=>[fe?"background":"active",J?"reloading":"idle",K,de&&!se?"timedOut":""]),[se,J,fe,de,K]);return e(Ve,{transition:G?{duration:0}:void 0,children:t(w,{delay:1e3,children:[e(o,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:t(a,{align:"center",style:{minHeight:0},children:[M&&e(u,{flex:"none",marginRight:1,padding:1,children:e(b,{animate:!0,content:e(d,{size:1,children:B("preview-frame.navigator.toggle-button.tooltip")}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(i,{"aria-label":B("preview-frame.navigator.toggle-button.aria-label"),fontSize:1,icon:Se,mode:"bleed",onClick:M,padding:2,selected:S})})}),e(b,{animate:!0,content:t(a,{align:"center",style:{whiteSpace:"nowrap"},children:[e(u,{padding:1,children:e(d,{size:1,children:B("preview-frame.overlay.toggle-button.tooltip",{context:V?"disable":"enable"})})}),e(u,{paddingY:1,children:e(te,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e(o,{as:"label",flex:"none",marginRight:1,padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:V?"transparent":void 0,children:t(a,{align:"center",gap:3,children:[e("div",{style:{margin:-4},children:e(x,{checked:V,onChange:F,disabled:"loading"===h.status||"connected"!==C})}),e(u,{children:e(d,{muted:!V,size:1,weight:"medium",children:B("preview-frame.overlay.toggle-button.text")})})]})})}),e(u,{flex:1,marginX:1,children:e(Tn,{prefix:e(u,{padding:1,children:e(b,{animate:!0,content:e(d,{size:1,children:"loaded"===h.status?B("preview-frame.refresh-button.tooltip"):B("preview-frame.status",{context:h.status})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(i,{"aria-label":B("preview-frame.refresh-button.aria-label"),fontSize:1,icon:Ie,mode:"bleed",loading:"reloading"===h.status||"refreshing"===h.status,onClick:ie,padding:2})})}),onChange:I,origin:re,suffix:e(u,{padding:1,children:e(P,{button:e(i,{fontSize:1,iconRight:_e,mode:"bleed",padding:2,space:2}),id:"location-menu",menu:e(k,{children:e(Un,{initialUrl:f,openPopup:z,previewLocationOrigin:re,previewLocationRoute:me})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),value:me})}),e(a,{align:"center",flex:"none",gap:1,padding:1,children:e(P,{button:e(i,{fontSize:1,iconRight:ze,mode:"bleed",padding:2,space:2,text:B(Mn["connected"===g?j:"previewDrafts"]),loading:"reconnecting"===g&&"loaded"!==h.status,disabled:"connected"!==g}),id:"perspective-menu",menu:t(k,{style:{maxWidth:240},children:[e(v,{fontSize:1,onClick:()=>U("previewDrafts"),padding:3,pressed:"previewDrafts"===j,tone:Nn,children:t(a,{align:"flex-start",gap:3,children:[e(u,{flex:"none",children:e(d,{size:1,children:T(Kn.previewDrafts)})}),t(c,{flex:1,space:2,children:[e(d,{size:1,weight:"medium",children:B(Mn.previewDrafts)}),e(d,{muted:!0,size:1,children:B("preview-frame.perspective.previewDrafts.text")})]}),e(u,{flex:"none",children:e(d,{muted:!0,size:1,style:{opacity:"previewDrafts"===j?1:0},children:e(De,{})})})]})}),e(v,{fontSize:1,onClick:()=>U("published"),padding:3,pressed:"published"===j,tone:Fn,children:t(a,{align:"flex-start",gap:3,children:[e(u,{flex:"none",children:e(d,{size:1,children:T(Kn.published)})}),t(c,{flex:1,space:2,children:[e(d,{size:1,weight:"medium",children:B(Mn.published)}),e(d,{muted:!0,size:1,children:B("preview-frame.perspective.published.text")})]}),e(u,{flex:"none",children:e(d,{muted:!0,size:1,style:{opacity:"published"===j?1:0},children:e(De,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e(a,{align:"center",flex:"none",gap:1,children:e(b,{animate:!0,content:e(d,{size:1,children:B("preview-frame.viewport-button.tooltip",{context:"desktop"===K?"narrow":"full"})}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(i,{"aria-label":B("preview-frame.viewport-button.aria-label"),fontSize:1,icon:"desktop"===K?Ce:$e,mode:"bleed",onClick:H,padding:2})})})]})}),e(o,{flex:1,tone:"transparent",children:t(a,{align:"center",height:"fill",justify:"center",padding:"desktop"===K?0:2,sizing:"border",style:{position:"relative",cursor:ne?"wait":void 0},children:[e(Be,{children:Y||J||Q||!de||se?(J||"connecting"===C&&"refreshing"!==h.status)&&!se?e(Wn,{initial:"initial",animate:"animate",exit:"exit",variants:qn,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:t(a,{style:{...Bn[K]},justify:"center",align:"center",direction:"column",gap:4,children:[e(E,{muted:!0}),e(d,{muted:!0,size:1,children:B("preview-frame.status",{context:"loading"})})]})}):Y&&!se?e(Wn,{initial:"initial",animate:"animate",exit:"exit",variants:Gn,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e(Xt,{flex:1,message:B("preview-frame.connection.error.text"),onRetry:oe,onContinueAnyway:ae,children:q&&t(n,{children:["connected"!==C&&e(o,{padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(m,{muted:!0,size:0,children:B("preview-frame.overlay.connection-status.label")}),e(p,{size:1,children:B("channel.status",{context:C})})]})}),"connected"!==g&&e(o,{padding:3,radius:2,tone:"critical",children:t(c,{space:3,children:[e(m,{muted:!0,size:0,children:B("preview-frame.loader.connection-status.label")}),e(p,{size:1,children:B("channel.status",{context:g})})]})})]})})}):null:e(Wn,{initial:"initial",animate:"animate",exit:"exit",variants:qn,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:X?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:X?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:t(a,{style:{...Bn[K]},justify:"center",align:"center",direction:"column",gap:4,children:[X&&e(i,{disabled:!0,fontSize:1,mode:"ghost",text:B("preview-frame.continue-button.text"),style:{opacity:0}}),e(o,{radius:2,tone:X?"caution":"inherit",padding:4,shadow:1,children:t(a,{justify:"center",align:"center",direction:"column",gap:4,children:[e(E,{muted:!0}),e(d,{muted:!0,size:1,children:B("preview-frame.status",X?{context:"timeout"}:{context:"connecting"})})]})}),X&&e(i,{fontSize:1,tone:"critical",onClick:ae,text:B("preview-frame.continue-button.text")})]})})}),e(Ln,{animate:ge,initial:["background"],onLoad:he,preventClick:fe,ref:s,src:f.toString(),variants:Hn})]})})]})})})),Bn={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},qn={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Gn={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Hn={desktop:{...Bn.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Bn.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};const Jn=function(e){const{documentId:t,documentType:n,navigate:r,perspective:i,documentRevision:o}=e,a=ne(t,n);return function(e,t,n,r,i){const o=C(r),a=O(t,n);R((()=>{const t=o.current;if(o.current=e,e!==t)return a(e,t)}),[a,i,e])}(i,(e=>{let t;if("published"===e&&a.published){const{_updatedAt:e,_rev:n}=a.published;t=`${e}/${n}`}o!==t&&r({},{rev:t},!0)}),[a,r,o]),null};let Xn=!1;function Zn(e,t){return e instanceof Function?e(t):e}function Qn(e,t){const n=Array.isArray(e)?e:[e];for(e of n){let n,r=e;if("string"==typeof e)try{const t=new URL(e);n=t.origin,r=t.pathname}catch{}if(!n||t.origin===n)try{const e=He(r,{decode:decodeURIComponent})(t.pathname);if(e){const{params:t,path:r}=e;return{origin:n,params:t,path:r}}}catch{throw new Error(`"${e}" is not a valid route pattern`)}}}function Yn(e){const{navigate:t,navigationHistory:n,path:r,previewUrl:i,resolvers:o=[]}=e,{state:a}=se(),s=Y({apiVersion:fe}),[c,d]=$(void 0),l=C(void 0),u=D((()=>{const e=r||a._searchParams?.find((([e])=>"preview"===e))?.[1]||"",t="string"==typeof i?i:"object"==typeof i&&i?.origin||location.origin;return new URL(e,t)}),[r,i,a._searchParams]),p=O((()=>{d(void 0),l.current=void 0}),[]);return R((()=>{if(o.length&&u){let i;for(const e of o){const t=Qn(e.route,u);if(t){i={context:t,resolver:e};break}}if(i){const o=function(e,t){if(e.resolve){const n=e.resolve(t)?.filter;return n?`*[${n}][0]{_id, _type}`:void 0}return"type"in e?`*[_type == "${e.type}"][0]{_id, _type}`:`*[${Zn(e.filter,t)}][0]{_id, _type}`}(i.resolver,i.context),a=(e=i.resolver,r=i.context,e.resolve?e.resolve(r)?.params??r.params:"type"in e?{}:Zn(e.params,r)??r.params);if(o){const e=new AbortController,r={perspective:"previewDrafts",signal:e.signal};return s.fetch(o,a,r).then((e=>{(!e||l.current!==e._id)&&(d({document:e,path:u.pathname}),l.current=e?._id,n.at(-1)?.id===n.at(-2)?.id&&t?.({id:e?._id,type:e?._type}))})).catch((e=>{e instanceof Error&&"AbortError"===e.name||(d({document:void 0,path:u.pathname}),l.current=void 0)})),()=>{e.abort()}}}}var e,r;p()}),[s,p,t,n,o,u]),c}function er(e){if(void 0===e)return;const t=decodeURIComponent(e)?.split(".");return"drafts"===t[0]&&t.shift(),t.join(".")}function tr(e){if(void 0!==e)return r.toString(function(e){const t=[];for(const n of e.split(".")){const e=St.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=It.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=_t.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function nr(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function rr({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r,frameStateRef:i}){const o=D((()=>{const{id:t,path:i,type:o}={id:er((a=n).id),path:tr(a.path),type:a.type};var a;return{id:t,type:o,path:i,preview:r.preview||`${e.pathname}${e.search}`,perspective:r.perspective,viewport:r.viewport,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,templateParams:r.templateParams,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}}),[n,r,e]),a=D((()=>nr({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,templateParams:o.templateParams,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.comment,o.inspect,o.instruction,o.path,o.pathKey,o.rev,o.since,o.template,o.templateParams,o.view]),s=D((()=>nr({perspective:o.perspective,preview:o.preview,viewport:o.viewport})),[o.perspective,o.preview,o.viewport]),c=C(n);R((()=>{c.current=n}),[n]);const[d,l]=$([n]);return{navigate:O(((e,n={},r)=>{e.id&&(e.id=K(e.id));const{_searchParams:o,...a}=c.current,s=(o||[]).reduce(((e,[t,n])=>(e[t]=n,e)),{}),d=nr({...a,...e}),u=nr({...s,...n});a.id!==d.id&&(delete u.template,delete u.templateParams),d._searchParams=Object.entries(u).reduce(((e,[t,n])=>[...e,[t,n]]),[]);const p=r??u.preview===i.current.url;l((e=>[...e,d])),t(d,{replace:p})}),[t,i]),navigationHistory:d,params:o,searchParams:s,structureParams:a}}function ir(e,t,n){const r=Y({apiVersion:fe}),i=Q(),o=i?.activeWorkspace?.basePath||"/",a=function(e,t,n,r){const[i,o]=$((()=>r||"")),a=C(0);R((()=>{if(i&&r)return window.clearTimeout(a.current),()=>{a.current=window.setTimeout((()=>{o("")}),100)}}),[i,r]);const s=ee();return D((()=>["@sanity/presentation",t,n,e,s?.id,or,i]),[t,s?.id,e,n,i])}(t,o,i?.activeWorkspace?.name||"default",n),s=function(e,t){const n=Y({apiVersion:fe}),r=ee(),[i,o]=$(""),a=e?Xe((async()=>await qe(n,"@sanity/presentation",typeof window>"u"?"":location.href,r?.id)),[...t,i]):null;return R((()=>{if(!a)return;const e=setTimeout((()=>{U((()=>o(a.expiresAt.toString())))}),a.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[a]),a?.secret||null}("object"==typeof e||"function"==typeof e,a);return Xe((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith(`${o}/`)&&r.pathname!==o?r:t}const t=await("object"==typeof e?Je(e):e)({client:r,previewUrlSecret:s,previewSearchParam:n,studioBasePath:o});return new URL(t,location.origin)}),[...a,s])}const or=Symbol();const ar=M((()=>import("./LoaderQueries.js"))),sr=M((()=>import("./PostMessageRefreshMutations.js"))),cr=de(a)`
  overflow-x: auto;
`;function dr(i){const{previewUrl:o,components:s}=i.tool.options??{},c=i.tool.name||be,{unstable_navigator:d}=s||{},{navigate:l,state:u}=se(),p=F(Object.fromEntries(u._searchParams||[])),m=ir(o||"/",c,p.preview||null),[h]=$((()=>{const e=i.tool.options?.devMode;return"function"==typeof e?e():"boolean"==typeof e?e:typeof window<"u"&&"localhost"===window.location.hostname})),f=D((()=>m.origin),[m.origin]),v=C(null),[g,y]=$(),[w,b]=$({}),x=C({title:void 0,url:void 0}),{navigate:P,navigationHistory:k,params:E,searchParams:I,structureParams:_}=rr({initialPreviewUrl:m,routerNavigate:l,routerState:u,routerSearchParams:p,frameStateRef:x}),z=D((()=>Rt(P,50)),[P]),[j,L]=A(En,{},On),T=D((()=>E.perspective?"published":"previewDrafts"),[E.perspective]),U=D((()=>E.viewport?"mobile":"desktop"),[E.viewport]),[M,N]=function(e,t){if("published"!==e&&"previewDrafts"!==e)throw new Error(`Invalid perspective: ${e}`);const[n,r]=$({}),[i,o]=$({}),a=C(""),s=O(((e,n,i=[])=>{const s=i.filter((e=>"_projectId"in e&&e._projectId?(Xn||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),Xn=!0),!1):e));("published"===n?r:o)((n=>{const r={};for(const e of s)r[e._id]=e;if(a.current!==t.current.url)return a.current=t.current.url,{[e]:r};const i=n[e];return Ge(i,r)?n:{...n,[e]:r}}))}),[t]);return[D((()=>{const t=Object.values("published"===e?n:i).reduce(((e,t)=>(Object.values(t).forEach((t=>{e[t._id]=t})),e)),{});return Object.values(t)}),[e,i,n]),s]}(T,x),K=re(),V=ie(),B=Yn({navigate:P,navigationHistory:k,path:E.preview,previewUrl:i.tool.options?.previewUrl,resolvers:i.tool.options?.resolve?.mainDocuments}),[q,G]=$("connecting"),[H,J]=$("connecting"),[X,Z]=$("connecting"),[Q]=$((()=>new Set)),Y=O((e=>{const t=window.open(e,"_blank");t&&Q.add(t)}),[Q]);R((()=>{if(Q.size&&g)for(const e of Q)e&&"closed"in e&&!e.closed&&g.addSource(e)}),[g,Q,Q.size]),R((()=>{const e=v.current?.contentWindow;if(!e)return;const t=function(e){const{destroy:t,send:n}=lt(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{t();for(const e of o)e()},send:(e,...t)=>{n(e,...t);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,...t)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:a}=lt({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(...e)=>{const[t]=e;if("preview-kit/documents"!==t&&"overlay/navigate"!==t&&"loader/documents"!==t)return n(...e)}:void 0}}))});o.add(a),i.set(t,n),r.add(t)}}}({id:"presentation",target:e,targetOrigin:f,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:G,onEvent(e,t){if("visual-editing/focus"!==e&&"overlay/focus"!==e||!("id"in t))if("visual-editing/navigate"===e||"overlay/navigate"===e){const{title:e,url:n}=t;x.current.url!==n&&z({},{preview:n}),x.current={title:e,url:n}}else"visual-editing/meta"===e?x.current.title=t.title:"visual-editing/toggle"===e||"overlay/toggle"===e?L({type:kn,enabled:t.enabled}):"visual-editing/documents"===e?N("visual-editing",t.perspective,t.documents):"visual-editing/refreshing"===e&&"manual"===t.source?clearTimeout(ve.current):"visual-editing/refreshing"===e&&"mutation"===t.source?L({type:xn}):"visual-editing/refreshed"===e&&L({type:bn});else z({type:t.type,id:t.id,path:t.path})}},{id:"loaders",heartbeat:!0,onStatusUpdate:J,onEvent(e,t){if("loader/documents"===e&&t.projectId===K&&t.dataset===V)N("loaders",t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===K&&t.dataset===V){if("number"==typeof t.heartbeat&&t.heartbeat<ge)throw new Error(`Loader query listen heartbeat interval must be at least ${ge}ms`);b((e=>({...e,[Ct(t.query,t.params)]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:t.heartbeat??!1}})))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:Z,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===K&&t.dataset===V&&N("preview-kit",t.perspective,t.documents)}}]});return y(t),()=>{t.destroy(),y(void 0)}}),[V,K,N,z,f]),R((()=>{const e=setInterval((()=>b((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))),ge);return()=>clearInterval(e)}),[]);const ee=O((e=>{z({path:r.toString(e)},{},!0)}),[z]),te=O((e=>{const t=new URL(e,m.origin),n=t.pathname+t.search;t.origin===m.origin&&n!==E.preview&&z({},{preview:n})}),[m,E,z]),ne=O((e=>{z({},e)}),[z]);R((()=>{g?.send("overlays","presentation/perspective",{perspective:T})}),[g,T]),R((()=>{E.id&&E.path?g?.send("overlays","presentation/focus",{id:E.id,path:E.path}):g?.send("overlays","presentation/blur",void 0)}),[g,E.id,E.path]),R((()=>{x.current.url&&E.preview&&x.current.url!==E.preview&&(x.current.url=E.preview,"connected"!==q&&v.current?v.current.src=`${f}${E.preview}`:g?.send("overlays","presentation/navigate",{url:E.preview,type:"replace"}))}),[g,q,f,E.preview]);const ae=O((()=>g?.send("overlays","presentation/toggleOverlay",void 0)),[g]),[ce,de]=$(null);R((()=>{const e=e=>{Ot(e)&&ae()},t=e=>{var t;Ot(e)&&ae(),t=e,["mod","\\"].every((e=>$t[e]?t[$t[e]]:t.key===e.toUpperCase()))&&ae()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[ae]);const[le,ue]=$(null),[{navigatorEnabled:pe,toggleNavigator:me},he]=vn({unstable_navigator:d}),fe=C(E.id);R((()=>{E.rev&&fe.current&&E.id!==fe.current&&z({},{rev:void 0}),fe.current=E.id}));const ve=C(),xe=O((e=>{if(L({type:xn}),g)return ve.current=window.setTimeout(e,300),void g.send("overlays","presentation/refresh",{source:"manual",livePreviewEnabled:"connected"===X||"connected"===H});e()}),[g,H,X]),Pe=oe(),ke=O((({id:e,type:t,path:n})=>{if(x.current.url)return{title:x.current.title||x.current.url,name:"edit",params:{id:e,path:n,type:t,inspect:ye,workspace:Pe.name,mode:we,preview:E.preview}}}),[E.preview,Pe.name]),Ee=O((e=>{z({},{viewport:"desktop"===e?void 0:"mobile"},!0)}),[z]),Se=O((e=>{z({},{perspective:"previewDrafts"===e?void 0:e})}),[z]);return t(n,{children:[e(wn,{devMode:h,name:c,navigate:z,params:E,searchParams:I,structureParams:_,children:e(fn,{navigate:z,children:e(yn,{params:E,children:e(cr,{height:"fill",children:t(Jt,{children:[e(he,{}),e(Tt,{id:"preview",minWidth:325,defaultSize:pe?50:75,order:3,children:e(a,{direction:"column",flex:1,height:"fill",ref:ue,children:e(S,{element:le,children:e(Vn,{dispatch:L,iframe:j.iframe,initialUrl:m,loadersConnection:H,navigatorEnabled:pe,onPathChange:te,onRefresh:xe,openPopup:Y,overlaysConnection:q,previewUrl:E.preview,perspective:T,ref:v,setPerspective:Se,setViewport:Ee,targetOrigin:f,toggleNavigator:me,toggleOverlay:ae,viewport:U,visualEditing:j.visualEditing})})})}),e(hn,{documentId:E.id,documentsOnPage:M,documentType:E.type,getCommentIntent:ke,mainDocumentState:B,onFocusPath:ee,onStructureParams:ne,searchParams:I,setDisplayedDocument:de,structureParams:_})]})})})})}),g&&e(W,{children:e(ar,{channel:g,liveQueries:w,perspective:T,liveDocument:ce,documentsOnPage:M})}),g&&E.id&&E.type&&e(W,{children:e(sr,{channel:g,id:E.id,type:E.type,loadersConnection:H,previewKitConnection:X})}),E.id&&E.type&&e(Jn,{documentId:E.id,documentRevision:E.rev,documentType:E.type,navigate:z,perspective:T})]})}export{dr as default};//# sourceMappingURL=PresentationTool.js.map
