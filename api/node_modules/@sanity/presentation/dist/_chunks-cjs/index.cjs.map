{"version":3,"file":"index.cjs","sources":["../../src/constants.ts","../../src/util/props.ts","../../src/useDocumentLocations.ts","../../src/i18n/index.ts","../../src/PresentationContext.ts","../../src/usePresentationTool.ts","../../src/document/LocationsBanner.tsx","../../src/document/useCurrentPresentationToolName.ts","../../src/document/PresentationDocumentContext.ts","../../src/document/PresentationDocumentHeader.tsx","../../src/document/PresentationDocumentProvider.tsx","../../src/fieldActions/openInStructure.ts","../../src/getIntentState.ts","../../src/router.ts","../../src/plugin.tsx","../../src/PresentationNavigateContext.ts","../../src/PresentationParamsContext.ts","../../src/usePresentationParams.ts","../../src/usePresentationNavigate.ts"],"sourcesContent":["import {ComposeIcon} from '@sanity/icons'\n\nexport const DEFAULT_TOOL_ICON = ComposeIcon\nexport const DEFAULT_TOOL_NAME = 'presentation'\nexport const DEFAULT_TOOL_TITLE = 'Presentation'\n\n// @todo import from core sanity package\nexport const COMMENTS_INSPECTOR_NAME = 'sanity/structure/comments'\n\nexport const EDIT_INTENT_MODE = 'presentation'\n\n// How long we wait until an iframe is loaded until we consider it to be slow and possibly failed\nexport const MAX_TIME_TO_OVERLAYS_CONNECTION = 3000 // ms\n\n// The API version to use when using `@sanity/client`\nexport const API_VERSION = '2023-10-16'\n\n// Heartbeats shouldn't fire on intervals that are so short it causes performance issues\nexport const MIN_LOADER_QUERY_LISTEN_HEARTBEAT_INTERVAL = 1000 // ms\n\n// Batch size for fetching documents building up the cache\nexport const LIVE_QUERY_CACHE_BATCH_SIZE = 100\n\n// Total cache size for documents that are live queried\nexport const LIVE_QUERY_CACHE_SIZE = 2048\n","import {\n  combineLatest,\n  from,\n  isObservable,\n  map,\n  mergeAll,\n  Observable,\n  of,\n  scan,\n  switchMap,\n} from 'rxjs'\n\ntype Props<K extends keyof any, T> = {\n  [P in K]: T | Observable<T>\n}\n\nfunction keysOf<T extends object>(value: T) {\n  return Object.keys(value) as (keyof T)[]\n}\n\nfunction setKey(source: Record<string, unknown>, key: any, value: unknown) {\n  return {\n    ...source,\n    [key]: value,\n  }\n}\n\nexport function props<K extends keyof any, T>(options: {wait?: boolean} = {}) {\n  return (source: Observable<Props<K, T>>): Observable<Record<string, unknown>> => {\n    return new Observable<Props<K, T>>((observer) => source.subscribe(observer)).pipe(\n      switchMap((object) => {\n        const keyObservables = keysOf(object).map((key) => {\n          const value = object[key]\n          return isObservable(value) ? from(value).pipe(map((val) => [key, val])) : of([key, value])\n        })\n\n        return options.wait\n          ? combineLatest(keyObservables).pipe(\n              map((pairs) => pairs.reduce((acc, [key, value]) => setKey(acc, key, value), {})),\n            )\n          : from(keyObservables).pipe(\n              mergeAll(),\n              scan((acc, [key, value]) => setKey(acc, key, value), {}),\n            )\n      }),\n    )\n  }\n}\n","import get from 'lodash.get'\nimport {useEffect, useMemo, useState} from 'react'\nimport {isObservable, map, Observable, of, switchMap} from 'rxjs'\n\nimport {\n  type DocumentStore,\n  isRecord,\n  isReference,\n  type Previewable,\n  type SanityDocument,\n  useDocumentStore,\n} from './internals'\nimport type {\n  DocumentLocationResolver,\n  DocumentLocationResolverObject,\n  DocumentLocationResolvers,\n  DocumentLocationsState,\n  DocumentLocationsStatus,\n} from './types'\nimport {props} from './util/props'\n\nconst INITIAL_STATE: DocumentLocationsState = {locations: []}\n\nfunction getDocumentId(value: Previewable) {\n  if (isReference(value)) {\n    return value._ref\n  }\n  return '_id' in value ? value._id : undefined\n}\n\nfunction cleanPreviewable(id: string | undefined, previewable: Previewable) {\n  const clean: Record<string, unknown> = id ? {...previewable, _id: id} : {...previewable}\n\n  if (clean['_type'] === 'reference') {\n    delete clean['_type']\n    delete clean['_ref']\n    delete clean['_weak']\n    delete clean['_dataset']\n    delete clean['_projectId']\n    delete clean['_strengthenOnPublish']\n  }\n\n  return clean\n}\n\nfunction listen(id: string, fields: string[], store: DocumentStore) {\n  const projection = fields.join(', ')\n  const query = `*[_id==$id][0]{${projection}}`\n  const params = {id}\n  return store.listenQuery(query, params, {\n    perspective: 'previewDrafts',\n  }) as Observable<SanityDocument | null>\n}\n\nfunction observeDocument(\n  value: Previewable | null,\n  paths: string[][],\n  store: DocumentStore,\n): Observable<Record<string, unknown> | null> {\n  if (!value || typeof value !== 'object') {\n    return of(value)\n  }\n\n  const id = getDocumentId(value)\n  const currentValue = cleanPreviewable(id, value)\n\n  const headlessPaths = paths.filter((path) => !(path[0] in currentValue))\n\n  if (id && headlessPaths.length) {\n    const fields = [...new Set(headlessPaths.map((path: string[]) => path[0]))]\n    return listen(id, fields, store).pipe(\n      switchMap((snapshot) => {\n        if (snapshot) {\n          return observeDocument(snapshot, paths, store)\n        }\n        return of(null)\n      }),\n    )\n  }\n\n  const leads: Record<string, string[][]> = {}\n  paths.forEach((path) => {\n    const [head, ...tail] = path\n    if (!leads[head]) {\n      leads[head] = []\n    }\n    leads[head].push(tail)\n  })\n  const next = Object.keys(leads).reduce((res: Record<string, unknown>, head) => {\n    const tails = leads[head].filter((tail) => tail.length > 0)\n    if (tails.length === 0) {\n      res[head] = isRecord(value) ? (value as Record<string, unknown>)[head] : undefined\n    } else {\n      res[head] = observeDocument((value as any)[head], tails, store)\n    }\n    return res\n  }, currentValue)\n\n  return of(next).pipe(props({wait: true}))\n}\n\nfunction observeForLocations(\n  documentId: string,\n  resolver: DocumentLocationResolverObject<string>,\n  documentStore: DocumentStore,\n) {\n  const {select} = resolver\n  const paths = Object.values(select).map((value) => String(value).split('.')) || []\n  const doc = {_type: 'reference', _ref: documentId}\n  return observeDocument(doc, paths, documentStore).pipe(\n    map((doc) => {\n      return Object.keys(select).reduce<Record<string, unknown>>((acc, key) => {\n        acc[key] = get(doc, select[key])\n        return acc\n      }, {})\n    }),\n    map(resolver.resolve),\n  )\n}\n\nexport function useDocumentLocations(props: {\n  id: string\n  resolvers?: DocumentLocationResolver | DocumentLocationResolvers\n  type: string\n}): {\n  state: DocumentLocationsState\n  status: DocumentLocationsStatus\n} {\n  const {id, resolvers, type} = props\n  const documentStore = useDocumentStore()\n  const [locationsState, setLocationsState] = useState<DocumentLocationsState>(INITIAL_STATE)\n\n  const resolver = resolvers && (typeof resolvers === 'function' ? resolvers : resolvers[type])\n\n  const [locationsStatus, setLocationsStatus] = useState<DocumentLocationsStatus>(\n    resolver ? 'resolving' : 'empty',\n  )\n\n  const result = useMemo(() => {\n    if (!resolver) return undefined\n\n    // Original/advanced resolver which requires explicit use of Observables\n    if (typeof resolver === 'function') {\n      const params = {id, type}\n      const context = {documentStore}\n      const _result = resolver(params, context)\n      return isObservable(_result) ? _result : of(_result)\n    }\n\n    // Simplified resolver pattern which abstracts away Observable logic\n    if ('select' in resolver && 'resolve' in resolver) {\n      return observeForLocations(id, resolver, documentStore)\n    }\n\n    // Resolver is explicitly provided state\n    return of(resolver)\n  }, [documentStore, id, resolver, type])\n\n  useEffect(() => {\n    const sub = result?.subscribe((state) => {\n      setLocationsState(state || INITIAL_STATE)\n      setLocationsStatus(state ? 'resolved' : 'empty')\n    })\n\n    return () => sub?.unsubscribe()\n  }, [result])\n\n  return {\n    state: locationsState,\n    status: locationsStatus,\n  }\n}\n","import {defineLocaleResourceBundle} from 'sanity'\n\n/**\n * The locale namespace for the presentation tool\n *\n * @public\n */\nexport const presentationLocaleNamespace = 'presentation' as const\n\n/**\n * The default locale bundle for the presentation tool, which is US English.\n *\n * @internal\n */\nexport const presentationUsEnglishLocaleBundle = defineLocaleResourceBundle({\n  locale: 'en-US',\n  namespace: presentationLocaleNamespace,\n  resources: () => import('./resources'),\n})\n","import {createContext} from 'react'\n\nimport type {\n  PresentationNavigate,\n  PresentationParams,\n  PresentationSearchParams,\n  StructureDocumentPaneParams,\n} from './types'\n\nexport interface PresentationContextValue {\n  devMode: boolean\n  name: string\n  navigate: PresentationNavigate\n  params: PresentationParams\n  structureParams: StructureDocumentPaneParams\n  searchParams: PresentationSearchParams\n}\n\nexport const PresentationContext = createContext<PresentationContextValue | null>(null)\n","import {useContext} from 'react'\n\nimport {PresentationContext, type PresentationContextValue} from './PresentationContext'\n\nexport function usePresentationTool(): PresentationContextValue {\n  const presentation = useContext(PresentationContext)\n\n  if (!presentation) {\n    throw new Error('Presentation context is missing')\n  }\n\n  return presentation\n}\n","import {\n  ChevronRightIcon,\n  DesktopIcon,\n  ErrorOutlineIcon,\n  InfoOutlineIcon,\n  WarningOutlineIcon,\n} from '@sanity/icons'\nimport {Box, Card, Flex, Spinner, Stack, Text} from '@sanity/ui'\nimport {\n  type ComponentType,\n  createElement,\n  type ReactNode,\n  useCallback,\n  useContext,\n  useState,\n} from 'react'\nimport {type ObjectSchemaType, useTranslation} from 'sanity'\nimport {useIntentLink} from 'sanity/router'\n\nimport {DEFAULT_TOOL_NAME, DEFAULT_TOOL_TITLE} from '../constants'\nimport {presentationLocaleNamespace} from '../i18n'\nimport {PresentationContext} from '../PresentationContext'\nimport type {DocumentLocation, DocumentLocationsState, PresentationPluginOptions} from '../types'\nimport {useCurrentPresentationToolName} from './useCurrentPresentationToolName'\n\nconst TONE_ICONS: Record<'positive' | 'caution' | 'critical', ComponentType> = {\n  positive: InfoOutlineIcon,\n  caution: WarningOutlineIcon,\n  critical: ErrorOutlineIcon,\n}\n\nexport function LocationsBanner(props: {\n  documentId: string\n  isResolving: boolean\n  options: PresentationPluginOptions\n  schemaType: ObjectSchemaType\n  showPresentationTitle: boolean\n  state: DocumentLocationsState\n}): ReactNode {\n  const {documentId, isResolving, options, schemaType, showPresentationTitle} = props\n  const {locations, message, tone} = props.state\n  const len = locations?.length || 0\n\n  const {t} = useTranslation(presentationLocaleNamespace)\n  const presentation = useContext(PresentationContext)\n  const [expanded, setExpanded] = useState(false)\n  const toggle = useCallback(() => {\n    if (!len) return\n    setExpanded((v) => !v)\n  }, [len])\n\n  const title = isResolving\n    ? t('locations-banner.resolving.text')\n    : message || t('locations-banner.locations-count', {count: len})\n\n  return (\n    <Card padding={1} radius={2} border tone={tone}>\n      <div style={{margin: -1}}>\n        {!locations && (\n          <Flex align=\"flex-start\" gap={3} padding={3}>\n            {tone && (\n              <Box flex=\"none\">\n                <Text size={1}>{createElement(TONE_ICONS[tone])}</Text>\n              </Box>\n            )}\n            <Box flex={1}>\n              <Text size={1} weight=\"medium\">\n                {showPresentationTitle && <>{options.title || DEFAULT_TOOL_TITLE} &middot; </>}\n                {title}\n              </Text>\n            </Box>\n          </Flex>\n        )}\n        {locations && (\n          <>\n            <Card\n              as={len ? 'button' : undefined}\n              onClick={toggle}\n              padding={3}\n              radius={1}\n              tone=\"inherit\"\n            >\n              <Flex gap={3}>\n                <Box flex=\"none\">\n                  {isResolving ? (\n                    <Spinner size={1} />\n                  ) : (\n                    <Text size={1}>\n                      {len === 0 ? (\n                        <InfoOutlineIcon />\n                      ) : (\n                        <ChevronRightIcon\n                          style={{\n                            transform: `rotate(${expanded ? '90deg' : 0})`,\n                            transition: 'transform 100ms ease-in-out',\n                          }}\n                        />\n                      )}\n                    </Text>\n                  )}\n                </Box>\n                <Box flex={1}>\n                  <Text size={1} weight=\"medium\">\n                    {showPresentationTitle && <>{options.title || DEFAULT_TOOL_TITLE} &middot; </>}\n                    {title}\n                  </Text>\n                </Box>\n              </Flex>\n            </Card>\n            <Stack hidden={!expanded} marginTop={1} space={1}>\n              {locations.map((l, index) => (\n                <LocationItem\n                  active={\n                    (options.name || DEFAULT_TOOL_NAME) === presentation?.name &&\n                    l.href === presentation?.params.preview\n                  }\n                  documentId={documentId}\n                  documentType={schemaType.name}\n                  key={index}\n                  node={l}\n                  toolName={options.name || DEFAULT_TOOL_NAME}\n                />\n              ))}\n            </Stack>\n          </>\n        )}\n      </div>\n    </Card>\n  )\n}\n\nfunction LocationItem(props: {\n  active: boolean\n  documentId: string\n  documentType: string\n  node: DocumentLocation\n  toolName: string\n}) {\n  const {documentId, documentType, node, active, toolName} = props\n  const presentation = useContext(PresentationContext)\n  const currentPresentationToolName = useCurrentPresentationToolName()\n  const isCurrentTool = toolName === currentPresentationToolName\n  const navigate = presentation?.navigate\n\n  const presentationLinkProps = useIntentLink({\n    intent: 'edit',\n    params: {\n      id: documentId,\n      type: documentType,\n      mode: 'presentation',\n      presentation: toolName,\n      ...presentation?.structureParams,\n      preview: node.href,\n    },\n  })\n\n  const handleCurrentToolClick = useCallback(() => {\n    navigate?.({}, {preview: node.href})\n  }, [node.href, navigate])\n\n  return (\n    <Card\n      {...(isCurrentTool ? {} : presentationLinkProps)}\n      as=\"a\"\n      key={node.href}\n      onClick={isCurrentTool ? handleCurrentToolClick : presentationLinkProps.onClick}\n      padding={3}\n      radius={1}\n      pressed={active}\n      tone=\"inherit\"\n    >\n      <Flex gap={3}>\n        <Box flex=\"none\">\n          <Text size={1}>\n            <DesktopIcon />\n          </Text>\n        </Box>\n        <Stack flex={1} space={2}>\n          <Text size={1} weight=\"medium\">\n            {node.title}\n          </Text>\n          <Text muted size={1} textOverflow=\"ellipsis\">\n            {node.href}\n          </Text>\n        </Stack>\n      </Flex>\n    </Card>\n  )\n}\n","import {usePresentationTool} from '../usePresentationTool'\n\nexport function useCurrentPresentationToolName(): string | undefined {\n  try {\n    return usePresentationTool().name\n  } catch {\n    return undefined\n  }\n}\n","import {createContext} from 'react'\n\nimport type {PresentationDocumentContextValue} from './types'\n\nexport const PresentationDocumentContext = createContext<PresentationDocumentContextValue | null>(\n  null,\n)\n","import {rem, Stack} from '@sanity/ui'\nimport {type ReactNode, useContext} from 'react'\nimport {type ObjectSchemaType} from 'sanity'\nimport {styled} from 'styled-components'\n\nimport {type PublishedId} from '../internals'\nimport type {PresentationPluginOptions} from '../types'\nimport {useDocumentLocations} from '../useDocumentLocations'\nimport {LocationsBanner} from './LocationsBanner'\nimport {PresentationDocumentContext} from './PresentationDocumentContext'\n\nconst LocationStack = styled(Stack)`\n  min-height: ${rem(42)};\n\n  & + &:empty {\n    display: none;\n  }\n`\n\nexport function PresentationDocumentHeader(props: {\n  documentId: PublishedId\n  options: PresentationPluginOptions\n  schemaType: ObjectSchemaType\n}): ReactNode {\n  const {documentId, options, schemaType} = props\n\n  const context = useContext(PresentationDocumentContext)\n  const {state, status} = useDocumentLocations({\n    id: documentId,\n    resolvers: options.resolve?.locations || options.locate,\n    type: schemaType.name,\n  })\n\n  if ((context && context.options[0] !== options) || status === 'empty') {\n    return null\n  }\n\n  const contextOptions = context?.options || []\n\n  return (\n    <LocationStack marginBottom={5} space={5}>\n      <Stack space={2}>\n        {contextOptions.map((options, idx) => (\n          <LocationsBanner\n            documentId={documentId}\n            isResolving={status === 'resolving'}\n            key={idx}\n            options={options}\n            schemaType={schemaType}\n            showPresentationTitle={contextOptions.length > 1}\n            state={state}\n          />\n        ))}\n      </Stack>\n    </LocationStack>\n  )\n}\n","import {\n  type ReactElement,\n  type ReactNode,\n  useCallback,\n  useContext,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react'\n\nimport type {PresentationPluginOptions} from '../types'\nimport {PresentationDocumentContext} from './PresentationDocumentContext'\nimport type {PresentationDocumentContextValue} from './types'\n\n/** @internal */\nexport function PresentationDocumentProvider(props: {\n  children?: ReactNode\n  options: PresentationPluginOptions\n}): ReactElement {\n  const {children, options} = props\n  const parent = useContext(PresentationDocumentContext)\n  const parentRegister = parent?.register\n\n  const [optionsArray, setOptionsArray] = useState<PresentationPluginOptions[]>(() => [])\n\n  const register = useCallback(\n    (options: PresentationPluginOptions) => {\n      if (parentRegister) {\n        return parentRegister(options)\n      }\n\n      setOptionsArray((prev) => [options].concat(prev))\n\n      return () => {\n        setOptionsArray((prev) => prev.filter((o) => o !== options))\n      }\n    },\n    [parentRegister],\n  )\n\n  const registerRef = useRef(register)\n  registerRef.current = register\n\n  const context: PresentationDocumentContextValue = useMemo(\n    () => ({\n      options: parent?.options || optionsArray,\n      register,\n    }),\n    [optionsArray, parent, register],\n  )\n\n  useLayoutEffect(() => registerRef.current(options), [options])\n\n  return (\n    <PresentationDocumentContext.Provider value={context}>\n      {children}\n    </PresentationDocumentContext.Provider>\n  )\n}\n","import {MasterDetailIcon} from '@sanity/icons'\nimport {useContext, useMemo} from 'react'\nimport {type Tool} from 'sanity'\nimport {useRouter} from 'sanity/router'\n\nimport {\n  defineDocumentFieldAction,\n  type DocumentFieldActionItem,\n  isRecord,\n  pathToString,\n  useWorkspace,\n} from '../internals'\nimport {PresentationContext} from '../PresentationContext'\n\nexport const openInStructure = defineDocumentFieldAction({\n  name: 'presentation/openInStructure',\n  useAction({documentId, documentType, path}) {\n    const workspace = useWorkspace()\n    const {navigateIntent} = useRouter()\n    const presentation = useContext(PresentationContext)\n\n    const defaultStructureTool = useMemo(\n      () => findStructureTool(workspace.tools, documentId, documentType),\n      [documentId, documentType, workspace.tools],\n    )\n\n    return {\n      type: 'action',\n      hidden: !presentation || path.length > 0 || !defaultStructureTool,\n      icon: defaultStructureTool?.icon || MasterDetailIcon,\n      title: `Open in ${defaultStructureTool?.title || 'Structure'}`,\n      onAction() {\n        navigateIntent('edit', {\n          id: documentId,\n          type: documentType,\n          mode: 'structure',\n          path: pathToString(path),\n        })\n      },\n      renderAsButton: true,\n    } satisfies DocumentFieldActionItem\n  },\n})\n\nfunction findStructureTool(\n  tools: Tool[],\n  documentId: string,\n  documentType: string,\n): Tool | undefined {\n  const results = tools.map((t) => {\n    const match = t.canHandleIntent?.(\n      'edit',\n      {\n        id: documentId,\n        type: documentType,\n        mode: 'structure',\n      },\n      {},\n    )\n\n    return {tool: t, match}\n  })\n\n  const modeMatches = results.filter((t) => isRecord(t.match) && t.match['mode'])\n\n  if (modeMatches.length > 0) {\n    return modeMatches[0].tool\n  }\n\n  const matches = results.filter((t) => t.match)\n\n  return matches[0]?.tool\n}\n","import {uuid} from '@sanity/uuid'\nimport {type RouterState, type SearchParam} from 'sanity/router'\n\nimport {encodeJsonParams, getPublishedId} from './internals'\nimport type {PresentationSearchParams, PresentationStateParams} from './types'\n\nconst preservedSearchParamKeys: Array<keyof PresentationSearchParams> = [\n  'preview',\n  'perspective',\n  'viewport',\n]\n\n/**\n * @internal\n */\nexport function getIntentState(\n  intent: string,\n  params: Record<string, string>,\n  routerState: RouterState | undefined,\n  payload: unknown,\n):\n  | (PresentationStateParams & {_searchParams: SearchParam[]})\n  | {intent: string; params: Record<string, string>; payload: unknown} {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const {id, mode, path, presentation, type, ...searchParams} = params\n\n  const preservedSearchParams = (routerState?._searchParams || [])\n    // @todo Casting https://github.com/microsoft/TypeScript/issues/14520\n    .filter(([key]) => preservedSearchParamKeys.includes(key as keyof PresentationSearchParams))\n    .reduce((acc, [key, value]) => ({...acc, [key]: value}), {} as Record<string, string>)\n\n  const _searchParams = {\n    ...preservedSearchParams,\n    ...searchParams,\n  }\n\n  if (intent === 'edit' && id) {\n    _searchParams['preview'] =\n      _searchParams['preview'] || new URLSearchParams(window.location.search).get('preview') || '/'\n    return {\n      type: type || '*',\n      id: getPublishedId(id),\n      path,\n      _searchParams: Object.entries(_searchParams),\n    }\n  }\n\n  if (intent === 'create') {\n    _searchParams['preview'] =\n      _searchParams['preview'] || new URLSearchParams(window.location.search).get('preview') || '/'\n\n    if (payload && typeof payload === 'object') {\n      _searchParams['templateParams'] = encodeJsonParams(payload as Record<string, unknown>)\n    }\n\n    return {\n      type: type || '*',\n      id: id || uuid(),\n      _searchParams: Object.entries(_searchParams),\n    }\n  }\n  return {intent, params, payload}\n}\n","import {route} from 'sanity/router'\n\nexport const router = route.create('/', {__unsafe_disableScopedSearchParams: true}, [\n  route.intents('/intent'),\n  route.create(':type', [route.create(':id', [route.create(':path')])]),\n])\n","import type {SanityDocument} from '@sanity/client'\nimport {lazy, Suspense} from 'react'\nimport {definePlugin, type InputProps, isDocumentSchemaType} from 'sanity'\n\nimport {DEFAULT_TOOL_ICON, DEFAULT_TOOL_NAME, EDIT_INTENT_MODE} from './constants'\nimport {PresentationDocumentHeader} from './document/PresentationDocumentHeader'\nimport {PresentationDocumentProvider} from './document/PresentationDocumentProvider'\nimport {openInStructure} from './fieldActions/openInStructure'\nimport {getIntentState} from './getIntentState'\nimport {presentationUsEnglishLocaleBundle} from './i18n'\nimport {getPublishedId} from './internals'\nimport {router} from './router'\nimport type {\n  DocumentLocationResolverObject,\n  DocumentLocationsState,\n  DocumentResolver,\n  PresentationPluginOptions,\n} from './types'\n\nconst PresentationTool = lazy(() => import('./PresentationTool'))\nconst BroadcastDisplayedDocument = lazy(() => import('./loader/BroadcastDisplayedDocument'))\n\n/**\n * Define locations for a given document type.\n * This function doesn't do anything itself, it is used to provide type information.\n * @param resolver - resolver that return locations for a document.\n * @public\n */\nexport function defineLocations<K extends string>(\n  resolver: DocumentLocationResolverObject<K> | DocumentLocationsState,\n): typeof resolver {\n  return resolver\n}\n\n/**\n * Define documents for a given location.\n * This function doesn't do anything itself, it is used to provide type information.\n * @param resolvers - resolvers that return documents.\n * @public\n */\nexport function defineDocuments(resolvers: DocumentResolver[]): typeof resolvers {\n  return resolvers\n}\n\nexport const presentationTool = definePlugin<PresentationPluginOptions>((options) => {\n  const toolName = options.name || DEFAULT_TOOL_NAME\n\n  if ('locate' in options) {\n    // eslint-disable-next-line no-console\n    console.warn('Presentation’s `locate` option is deprecated. Use `resolve.locations` instead.')\n  }\n\n  const hasLocationsResolver = !!(options.resolve?.locations || options.locate)\n\n  function PresentationDocumentInput(props: InputProps) {\n    const value = props.value as SanityDocument\n    const documentId = value?._id ? getPublishedId(value?._id) : undefined\n\n    if (isDocumentSchemaType(props.schemaType)) {\n      return (\n        <PresentationDocumentProvider options={options}>\n          {hasLocationsResolver && documentId && (\n            <PresentationDocumentHeader\n              documentId={documentId}\n              options={options}\n              schemaType={props.schemaType}\n            />\n          )}\n          {props.renderDefault(props)}\n          <Suspense key=\"broadcast-displayed-document\">\n            <BroadcastDisplayedDocument key={documentId} value={value} />\n          </Suspense>\n        </PresentationDocumentProvider>\n      )\n    }\n\n    return props.renderDefault(props)\n  }\n\n  function canHandleCreateIntent(params: Record<string, unknown>) {\n    // We can't handle create intents without a `type` parameter\n    if (!('type' in params)) {\n      return false\n    }\n\n    if ('presentation' in params && params['presentation'] !== toolName) {\n      return false\n    }\n\n    return 'template' in params ? {template: true} : true\n  }\n\n  function canHandleEditIntent(params: Record<string, unknown>) {\n    // We can't handle edit intents without `type` or `id` parameters\n    if (!('type' in params) || !('id' in params)) {\n      return false\n    }\n\n    if ('presentation' in params && params['presentation'] !== toolName) {\n      return false\n    }\n\n    return 'mode' in params ? {mode: params['mode'] === EDIT_INTENT_MODE} : true\n  }\n\n  return {\n    i18n: {\n      bundles: [presentationUsEnglishLocaleBundle],\n    },\n    document: {\n      unstable_fieldActions: (prev) => {\n        return [\n          ...prev.filter((a) => a.name !== openInStructure.name), // prevent duplication\n          openInStructure,\n        ]\n      },\n    },\n\n    form: {\n      components: {\n        input: PresentationDocumentInput,\n      },\n    },\n\n    tools: [\n      {\n        icon: options.icon || DEFAULT_TOOL_ICON,\n        name: toolName,\n        title: options.title,\n        component: PresentationTool,\n        options,\n        canHandleIntent(intent, params) {\n          if (intent === 'create') return canHandleCreateIntent(params)\n          if (intent === 'edit') return canHandleEditIntent(params)\n          return false\n        },\n        getIntentState,\n        router,\n      },\n    ],\n  }\n})\n","import {createContext} from 'react'\n\nexport type PresentationNavigateContextValue = (\n  preview: string | undefined,\n  document?: {type: string; id: string},\n) => void\n\nexport const PresentationNavigateContext = createContext<PresentationNavigateContextValue | null>(\n  null,\n)\n","import {createContext} from 'react'\n\nimport type {PresentationParams} from './types'\n\nexport const PresentationParamsContext = createContext<PresentationParams | null>(null)\n","import {useContext} from 'react'\n\nimport {PresentationParamsContext} from './PresentationParamsContext'\nimport type {PresentationParams} from './types'\n\n/** @public */\nexport function usePresentationParams(throwOnMissingContext?: true): PresentationParams\n/** @public */\nexport function usePresentationParams(throwOnMissingContext: false): PresentationParams | null\n/** @public */\nexport function usePresentationParams(throwOnMissingContext = true): PresentationParams | null {\n  const params = useContext(PresentationParamsContext)\n\n  if (throwOnMissingContext && !params) {\n    throw new Error('Presentation params context is missing')\n  }\n\n  return params\n}\n","import {useContext} from 'react'\n\nimport {\n  PresentationNavigateContext,\n  type PresentationNavigateContextValue,\n} from './PresentationNavigateContext'\n\nexport function usePresentationNavigate(): PresentationNavigateContextValue {\n  const navigate = useContext(PresentationNavigateContext)\n\n  if (!navigate) {\n    throw new Error('Presentation navigate context is missing')\n  }\n\n  return navigate\n}\n\nexport type {PresentationNavigateContextValue}\n"],"names":["DEFAULT_TOOL_ICON","ComposeIcon","DEFAULT_TOOL_NAME","DEFAULT_TOOL_TITLE","EDIT_INTENT_MODE","setKey","source","key","value","props","options","Observable","observer","subscribe","pipe","switchMap","object","keyObservables","Object","keys","map","isObservable","from","val","of","wait","combineLatest","pairs","reduce","acc","mergeAll","scan","INITIAL_STATE","locations","observeDocument","paths","store","id","isReference","_ref","_id","getDocumentId","currentValue","previewable","clean","_type","_weak","_dataset","_projectId","_strengthenOnPublish","cleanPreviewable","headlessPaths","filter","path","length","fields","query","join","params","listenQuery","perspective","listen","Set","snapshot","leads","forEach","head","tail","push","next","res","tails","isRecord","useDocumentLocations","resolvers","type","documentStore","useDocumentStore","locationsState","setLocationsState","useState","resolver","locationsStatus","setLocationsStatus","result","useMemo","_result","documentId","select","values","String","split","doc","get","resolve","observeForLocations","useEffect","sub","state","unsubscribe","status","presentationLocaleNamespace","presentationUsEnglishLocaleBundle","defineLocaleResourceBundle","locale","namespace","resources","Promise","then","require","PresentationContext","createContext","usePresentationTool","presentation","useContext","Error","TONE_ICONS","positive","InfoOutlineIcon","caution","WarningOutlineIcon","critical","ErrorOutlineIcon","LocationsBanner","isResolving","schemaType","showPresentationTitle","message","tone","len","t","useTranslation","expanded","setExpanded","toggle","useCallback","v","title","count","jsx","Card","padding","radius","border","children","style","margin","Flex","align","gap","jsxRuntime","Box","flex","Text","size","createElement","weight","jsxs","Fragment","as","onClick","Spinner","ChevronRightIcon","transform","transition","Stack","hidden","marginTop","space","l","index","LocationItem","active","name","href","preview","documentType","node","toolName","isCurrentTool","useCurrentPresentationToolName","navigate","presentationLinkProps","useIntentLink","intent","mode","structureParams","handleCurrentToolClick","react","pressed","DesktopIcon","muted","textOverflow","PresentationDocumentContext","LocationStack","styled","rem","PresentationDocumentHeader","context","locate","contextOptions","marginBottom","idx","PresentationDocumentProvider","parent","parentRegister","register","optionsArray","setOptionsArray","prev","concat","o","registerRef","useRef","current","useLayoutEffect","Provider","openInStructure","defineDocumentFieldAction","useAction","workspace","useWorkspace","navigateIntent","useRouter","defaultStructureTool","tools","results","match","canHandleIntent","tool","modeMatches","findStructureTool","icon","MasterDetailIcon","onAction","pathToString","renderAsButton","preservedSearchParamKeys","getIntentState","routerState","payload","searchParams","_searchParams","includes","URLSearchParams","window","location","search","getPublishedId","entries","templateParams","encodeJsonParams","uuid","router","route","create","__unsafe_disableScopedSearchParams","intents","PresentationTool","lazy","BroadcastDisplayedDocument","presentationTool","definePlugin","console","warn","hasLocationsResolver","i18n","bundles","document","unstable_fieldActions","a","form","components","input","isDocumentSchemaType","renderDefault","Suspense","component","template","canHandleCreateIntent","canHandleEditIntent","PresentationNavigateContext","PresentationParamsContext","exports","A","C","D","E","L","M","P","b","c","d","throwOnMissingContext","e","f","g","h","i","p","u"],"mappings":"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"}